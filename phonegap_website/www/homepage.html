<!DOCTYPE html>
<html lang="en">

<head>

    <script>
        var account = sessionStorage.getItem("account_id");
        if(! account){ // if not defined (i.e. value is undefined or null)
            location.replace("index.html");
        }else{
            var isAdmin = sessionStorage.getItem("isAdmin");
            if(! isAdmin || isAdmin == "false"){ // if not defined or false
                location.replace("homepage_client.html");
            }
        }
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Deloitte New Zealand </title>
    <link rel=" shortcut icon" href="imgs/favicon.ico">

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/agency.css" rel="stylesheet">
    <link href="css/select2.min.css" rel="stylesheet">
    <link href="css/modal.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet'
          type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>

    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/scripts/webServices.js"></script>
    <script src="js/select2.min.js"></script>
    <script src="js/scripts/homepage.js"></script>

    <script type="application/javascript" src="js/raphael-min.js"></script>
    <script type="application/javascript" src="js/colorwheel.js"></script>

    <script type="text/javascript" src="js/jquery.autocomplete.min.js"></script>

    <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

    <script src="js/iframeResizer.min.js"></script>

    <!--pNotify related links-->
    <script type="application/javascript" src="js/pnotify.custom.min.js"></script>
    <link rel="stylesheet" href="css/pnotify.custom.min.css"/>

    <!--Loading screen-->
    <script src="js/pace.min.js"></script>
    <link href="css/atom.css" rel="stylesheet">

    <script type="application/javascript">
        $(document).ready(function () {

            // Wrapping of default alert
            window.alert = function (message) {
                new PNotify({
                    title: 'Alert',
                    text: message,
                    type: alert_type,
                    opacity: .8,
                    nonblock: {
                        nonblock: true,
                        nonblock_opacity: .2
                    },
                    buttons: {
                        show_on_nonblock: true
                    }
                });
            };

            $('#frameQual').iFrameResize();
            $('#frameCreateClient').iFrameResize();
            $('#frameCreateProj').iFrameResize();
            $('#frameViewQual').iFrameResize();

            // Event handling for when the modal's are closed the iframes are unloaded,
            // TODO Add loading of iframe src's to relevant openModal functions
            // E.g. $('#frameViewQual').attr('src', 'view_qual.html');
            $('#qualModal').on('hidden.bs.modal', function () {
                $('#frameQual').attr('src', '');
                $('#qualModalLabel').text("");
            });

            $('#createProjModal').on('hidden.bs.modal', function () {
                $('#frameCreateProj').attr('src', '');
            });

            $('#createClientModal').on('hidden.bs.modal', function () {
                $('#frameCreateClient').attr('src', '');
            });

            $('#viewQualModal').on('hidden.bs.modal', function () {
                $('#frameViewQual').attr('src', '');
                $('#client-logo').attr('src', '');
                $('#qual-projectName').text('');
            });

            //the project cart will be hidden when the user clicks elsewhere on the screen
            $(document).click(function (e) {
                e.preventDefault();
                $('body').removeClass('nav-expanded');
                $('#logoutButton').css('marginRight', '200px');
            });
            $("#nav-expander").click(function (e) {
                e.stopImmediatePropagation();
                e.preventDefault();
                if ($('body').hasClass('nav-expanded')) {
                    $('body').removeClass('nav-expanded');
                    $('#logoutButton').css('marginRight', '200px');
                } else {
                    $('body').toggleClass('nav-expanded');
                    $('#logoutButton').css('marginRight', '500px');
                }
            });

            $("#projectCartNav, #qualCollection", "#deleteQual").click(function(e) {
                e.stopImmediatePropagation();
                if (this.id = 'qualCollection') {
                    $('#createProjModal').modal('show');
                } else if (this.id = 'projectCartNav') {
                    e.stopPropagation();
                    return false;
                }else if(this.id = 'deleteQual'){
//                    e.stopImmediatePropagation();
                    e.preventDefault();
                    $('#createProjModal').modal('hide');
                    $('body').toggleClass('nav-expanded');
                    $('#logoutButton').css('marginRight', '500px');
                }

            });

            $('#newQual').click(function (e) {
                e.stopImmediatePropagation();
                window.location.replace("qual_add.html")
            });

            $('#logoutUser').click(function (e) {
                e.stopImmediatePropagation();
                sessionStorage.clear();
                window.location.replace('index.html');
            });

            document.getElementById("divArchiveAlert").style.display = 'none';
            //this is to hide the div containing the notification of "qual added to cart"
            document.getElementById("divAddToCartAlert").style.display = 'none';
        });

        function confirmArchive(archiveType, itemID){
            $('#form_submit').text('Delete').addClass("btn-danger");
            $('#form_body').text('This will be deleted. This can only be undone by a superuser. Are you sure?');

            if(archiveType == "CLIENT"){
                confirmAction(itemID, "Heads Up!", "error", "CLIENT", "Client successfully archived!");
            }else if(archiveType == "PROJECT"){
                confirmAction(itemID, "Heads Up!", "error", "PROJECT", "Project successfully archived!")
            }else if(archiveType == "QUAL"){
                confirmAction(itemID, "Heads Up!", "error", "QUAL", "Qual successfully archived!");
            }
        }

        function confirmAction(item_id, notice_title, notice_type, submit_option, success_message) {
            var notice = new PNotify({
                title: notice_title,
                text: $('#form_notice').html(),
                icon: true,
                width: 'auto',
                hide: false,
                type: notice_type,
                buttons: {
                    closer: false,
                    sticker: false
                },
                insert_brs: false
            });
            notice.get().find('form.pf-form').on('click', '[name=cancel]', function () {
                cleanseForm();
                notice.remove();
            }).submit(function () {

                if(submit_option == "CLIENT")
                {
                    archiveClient(item_id);
                    //location.reload();
                }
                else if(submit_option == "PROJECT")
                {
                    archiveProject(item_id);
                    //location.reload();
                }
                else if(submit_option == "QUAL")
                {
                    archiveQual(item_id);
                    //location.reload();
                }

                cleanseForm();
                notice.update({
                    title: 'Completed',
                    text: success_message,
                    icon: true,
                    width: PNotify.prototype.options.width,
                    hide: true,
                    buttons: {
                        closer: true,
                        sticker: true
                    },
                    type: 'success'
                });
                return false;
            });
        }

        function cleanseForm(){
            $('#form_title').text("");
            $('#form_body').text("");

            $('#form_submit').text("").removeClass('btn-primary btn-danger');

        }

    </script>
</head>

<body id="page-top" class="index">

<div id="form_notice" style="display: none;">
    <form action method="POST" class="pf-form">
        <div class="pf-element">
            <div id="form_body">
            </div>
        </div>
        <div class="pf-element pf-buttons">
            <button id="form_cancel" type="button" name="cancel" class="pf-button btn btn-default">Cancel</button>
            <button id="form_submit" type="submit" name="submit" class="pf-button btn"></button>
        </div>
    </form>
</div>

<!-- Add/Edit/Duplicate Qual Modal -->
<div class="qualModal modal fade" id="qualModal" tabindex="-1" role="dialog" aria-labelledby="qualModalLabel">
    <div class="modal-dialog modal-xl" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i
                        class="fa fa-times fa-2x"></i></button>
                <h4 class="modal-title" id="qualModalLabel"></h4>
            </div>
            <div class="modal-body">
                <iframe id="frameQual" src="" width="100%" scrolling="no" frameborder="0"></iframe>
            </div>
            <div class="modal-footer hidden">
                <button id="btnQualModalClose" type="button" class="hidden btn btn-default" data-dismiss="modal">Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Navigation -->

<nav id="projectCartNav">
    <ul class="list-unstyled main-menu" id="ProjectCart">
        <li>
            <button id="qualCollection" type='submit' class='btn btn-lg' data-toggle="modal"
                    data-target="#createProjModal">Create Project
            </button>
            <a class="pull-right" href="#" id="nav-close"></a>
        </li>
    </ul>
</nav>

<div id="createProjModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Create Project</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" role="form" id="createProjForm">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Project Name</label>

                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="projName"/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="radio col-sm-3">
                            <label><input type="radio" id="existingClientSelect" style="text-align: left;"
                                          class="control-label" name="clientRadio">Existing Client</label>
                        </div>
                        <div class="col-sm-9" style="padding-bottom: 15px;">
                            <select id="clientDropdown" class="form-control"
                                    style="width: 100% !important;height:34px !important;">
                            </select>
                        </div>
                        <div class="radio col-sm-3">
                            <label><input type="radio" id="newClientSelect" class="control-label" for="modalClientName"
                                          name="clientRadio">Client
                                Name</label>
                        </div>
                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="modalClientName"/>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="createProjBtn">Create</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->

<div id="createClientModal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Create Client</h4>
            </div>
            <div class="modal-body">
                <form class="form-horizontal" role="form" id="createClientForm">
                    <div class="form-group">
                        <label class="col-sm-3 control-label" for="modalClientName">Client Name</label>

                        <div class="col-sm-9">
                            <input type="text" class="form-control" id="clientName" value=""/>
                        </div>
                    </div>
                </form>
                <div class="alert alert-info alert-dismissible" role="alert">
                    Please be mindful of the two colour combinations and the contrast between them.
                </div>
                <div class="row">
                    <div id="primary_color_wheel" class="col-md-6 col-xs-8">
                        <label for="qual_colour_primary">Primary Colour: </label>
                        <input id="qual_colour_primary" type="text" maxlength="7" style="max-width: 100px;"
                               class="form-control" value="#091D5D" placeholder="#091D5D">

                        <div class="colorwheel"></div>
                    </div>
                    <div id="secondary_color_wheel" class="col-md-6 col-xs-8">
                        <label for="qual_colour_secondary">Secondary Colour: </label>
                        <input id="qual_colour_secondary" type="text" maxlength="7" style="max-width: 100px;"
                               class="form-control" value="#DDD2B5" placeholder="#DDD2B5">

                        <div class="colorwheel"></div>
                    </div>

                </div>
                <div style="height: 15px;"></div>
                <div style="display: none" id="passwordAlert" class="alert alert-success alert-dismissible" role="alert">

                </div>
                </form>

                <!--<iframe id="frameQualAdd" src="qual_add.html" width="100%" scrolling="no" frameborder="0"></iframe>-->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="createClientBtn">Create</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
<div class="navbar navbar-inverse navbar-fixed-top">

    <div class="container-fluid">
        <!--<div class="navbar-header">-->
        <!--<a class="navbar-brand" href="#">WebSiteName</a>-->
        <!--</div>-->
        <div class="navbar-header pull-right">

            <a id="nav-expander" class="nav-expander fixed" data-toggle="collapse" data-target=".temp">
                Qual Collection &nbsp;<i class="fa fa-bars fa-lg white"></i>
            </a>
        </div>

        <div id="logoutButton" style="margin-right: 200px">
            <ul id="hiddenNew" class="nav navbar-nav navbar-right">
                <li><a href="index.html" id="logoutUser" style="color: white"
                       onclick="javascript: sessionStorage.clear();">Logout <span
                        class="glyphicon glyphicon-log-out"></span></a></li>
                <li class="dropdown active">

                    <a href="#" class="dropdown-toggle fa fa-plus fa-lg white" data-toggle="dropdown" style="background-color: #222;"> <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#" data-toggle="modal" data-target="#qualModal" onclick="addQual();">New Qual</a>
                        </li>
                        <li><a href="#" data-toggle="modal" data-target="#createProjModal" onclick="resetProjID()">New
                            Project</a></li>
                        <li><a href="#" data-toggle="modal" data-target="#createClientModal">New Client</a></li>
                    </ul>
                </li>
            </ul>
        </div>


        <div class="col-sm-5 spec_vertical_center" style="padding-left: 36px;">
            <div  class="input-group stylish-input-group">
                <input id="searchBox" type="text" class="form-control"  placeholder="Search..." onkeyup="search()" >
                    <span id="searchIcon" class="input-group-addon" style="font-size:13px">
                        <button type="button">
                            <span class="glyphicon glyphicon-search"></span>

                        </button>
                    </span>
            </div>
            <ul class="nav navbar-nav">
                <li id="resultLI" class="dropdown active">
                    <ul id="resultUL" class="dropdown-menu" style="width:695px; ">

                    </ul>
                </li>
            </ul>
        </div>
        <div class="col-md-1" id="superAdminDiv">
        </div>
    </div>

</div>

<script>

    var htmlClientProject = "";
    var qualsToAdd = [];
    var projGroupID = -1;
    var projName = "";

    $(document).ready(function () {

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var target = $(e.target).attr("href"); // activated tab
            loadTab(target);
        });

        var account_id = sessionStorage.getItem("account_id");
        getProjects(account_id);
        getEverything();

        $('#createProjBtn').click(function (e) {
            e.preventDefault();
            var projName = $('#projName').val();
            var clientName = $("#clientName").val();
            $('#createProjModal').modal('hide');
            createProjectGroup(projName);

        });

        getAccountById(account_id, function() {
           var account = this;
            if (account.isSuperUser == true) {
                var htmlStr = "<button id='superAdminBtn' class='btn spec_vertical_center'>Access Super User</button>";
                $("#superAdminDiv").html(htmlStr);
                $("#superAdminBtn").click(function (e) {
                    document.location.href = "superuser_view.html";
                });
            }
        });

        $('#createClientBtn').click(function (e) {
            e.preventDefault();
            var clientName = $("#clientName").val();
            var primaryColour = $("#qual_colour_primary").val();
            var secondaryColour = $("#qual_colour_secondary").val();
            $("#clientName").val("");
            var clientPw = createClient(clientName, primaryColour, secondaryColour);
            var htmlStr = "<button type='button' class='close' data-dismiss='alert' aria-label='Close'><span aria-hidden='true'>&times;</span></button>" +
                    "Client "+clientName + " has been added! The password for the client is: <strong>"+clientPw +"</strong>"

            $("#passwordAlert").html(htmlStr);
            $("#passwordAlert").show();
        });

        var primaryCW = Raphael.colorwheel($("#primary_color_wheel .colorwheel"), 150, 256);
        primaryCW.input($("#qual_colour_primary")[0]);

        var secondaryCW = Raphael.colorwheel($("#secondary_color_wheel .colorwheel"), 150, 256);
        secondaryCW.input($("#qual_colour_secondary")[0]);

        var vnSpace = $('#space');
        var hnSpace = $('#hiddenSpace');

        str = '\
        <li><a href="index.html" onclick="javascript: sessionStorage.clear();">Logout <span class="glyphicon glyphicon-log-out"></span></a></li>\
        <li class="dropdown active">\
            <a href="#" class="dropdown-toggle fa fa-plus fa-lg white" data-toggle="dropdown"> <span class="caret"></span></a>\
            <ul class="dropdown-menu">\
                <li><a href="#" data-toggle="modal" data-target="#qualModal" onclick="addQual();">New Qual</a></li>\
                <li><a href="#" data-toggle="modal" data-target="#createProjModal" onclick="resetProjID()">New Project</a></li>\
                <li><a href="#" data-toggle="modal" data-target="#createClientModal">New Client</a></li>\
            </ul>\
        </li>';


//        vnSpace.before(str);
//        hnSpace.before(str);

        $(window).on('shown.bs.modal', function () {

            getAllClients(function () {
                var clients = this;
                var htmlStr = "";
                for (i = 0; i < clients.length; i++) {
                    htmlStr += "<option value='" + clients[i].accountId + "'>" + clients[i].accountName + "</option>";
                }

                var res = $.map(clients, function (item) {
                    return {
                        id: item.accountId,
                        text: item.accountName
                    };
                })

                $("#clientDropdown").select2({data: res});
            });
        });
    });


</script>

<section id="portfolio" class="bg-light-gray" style="padding: 0px; padding-top: 22px">
    <div class="container" style="margin: 0px; padding: 0px; width: inherit;">
        <!-- Services Section -->
        <div class="row">
            <div class="col-md-12">
                <div id="divArchiveAlert" class="alert alert-danger alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">x</span>
                    </button>
                    <h3 id="archiveHeading">Delete</h3>

                    <p id="archiveMessage" class="body"> This is irreversible</p>

                    <p>
                        <button id="confirmButton" type="button" class="btn btn-danger">CONFIRM</button>
                        <button id="cancelButton" type="button" class="btn btn-default">CANCEL</button>
                    </p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div id="divAddToCartAlert" class="alert alert-success alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">x</span>
                    </button>
                    <h3 id="addToCartAlertHeading">The following qual(s) has been added to cart</h3>

                    <p id="displayQualName" class="body"></p><br/>

                    <p>
                        <button id="addToCartOkButton" type="button" class="btn btn-success">OK</button>
                    </p>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-md-12" style="margin-bottom: 30px;">

                <!-- Nav tabs -->
                <div>
                    <ul class="nav nav-tabs nav-justified" role="tablist" id="tablist">
                        <li id="qualsTab" role="presentation"><a href="#quals" aria-controls="quals" role="tab"
                                                                 data-toggle="tab">Quals</a></li>
                        <li id="projectsTab" role="presentation" class="active"><a href="#projects"
                                                                                   aria-controls="projects" role="tab"
                                                                                   data-toggle="tab">Projects</a></li>
                        <li id="clientsTab" role="presentation"><a href="#clients" aria-controls="clients" role="tab"
                                                                   data-toggle="tab">Clients</a></li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div role="tabpanel" class="tab-pane active" id="projects"></div>
                        <div role="tabpanel" class="tab-pane" id="quals"></div>
                        <div role="tabpanel" class="tab-pane" id="clients"></div>
                    </div>

                </div>
            </div>

        </div>
    </div>
</section>

<footer></footer>

<!-- Modal For View Qual page -->
<div class="portfolio-modal modal fade" id="viewQualModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-xl" role="document" style= "position: fixed;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="logo-modal">
                    <img class="logo-image" src="" id="client-logo">
                </div>
                <h3 id="qual-projectName"></h3>
                <div class="close-modal" data-dismiss="modal">
                    <i class="fa fa-times fa-5x"></i>
                </div>
                <div id="btnDuplicate" class="close-modal further_right" onclick="">
                    <i class="fa fa-clipboard fa-3x vertical_center"></i>
                </div>
            </div>
            <div class="modal-body" id="modal_body">
                <iframe id="frameViewQual" src="" width="100%" scrolling="no" frameborder="0"></iframe>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>

<!-- Plugin JavaScript -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="js/classie.js"></script>
<script src="js/cbpAnimatedHeader.js"></script>

<!-- Contact Form JavaScript -->
<script src="js/jqBootstrapValidation.js"></script>
<script src="js/contact_me.js"></script>

<!-- Custom Theme JavaScript -->
<script src="js/agency.js"></script>

</body>
</html>
