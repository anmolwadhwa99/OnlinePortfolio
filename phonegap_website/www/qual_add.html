<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <script>
        var account = sessionStorage.getItem("account_id");
        if(! account){ // if not defined (i.e. value is undefined or null)
            alert("Please login first");
            location.replace("index.html");
        }else{
            var isAdmin = sessionStorage.getItem("isAdmin");
            if(! (isAdmin == null) && isAdmin == false){ // if not defined or false
                alert("Sorry you do not have access to this page");
                location.replace("homepage_client.html");
            }else{
                var addStatus = sessionStorage.getItem("add_qual");
                sessionStorage.removeItem("add_qual");
                var editId = sessionStorage.getItem("edit_qual_id");
                var dupId = sessionStorage.getItem("dup_qual_id");
                // if not (adding qual) or (editing qual) or (duplicating qual) then block access
                // Also shouldn't be able to do multiple operations at the sametime (i.e. add and edit, or edit and dup)
                if (!((addStatus && !editId && !dupId) || (!addStatus && editId && !dupId) || (!addStatus && !editId && dupId))) {
                    console.log(addStatus + " " + editId + " " + dupId);
//                    alert("Please use the supplied add/edit/duplicate qual buttons to access the qual page");
                    location.replace("homepage.html");
                }
            }
        }
    </script>
    <script type="application/javascript" src="js/jquery-2.1.4.min.js"></script>
    <script src="js/Fullscreen-Loading-Indicators-with-jQuery-CSS3-HoldOn-js/src/js/HoldOn.min.js"></script>
    <meta name="description" content="">
    <meta name="author" content="">

    <title id="page_title">Add New Qual</title>
    <link rel=" shortcut icon" href="imgs/favicon.ico">

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="js/Fullscreen-Loading-Indicators-with-jQuery-CSS3-HoldOn-js/src/css/HoldOn.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="js/html5shiv.min.js"></script>
    <script src="js/respond.min.js"></script>
    <![endif]-->

    <script type="application/javascript" src="js/bootstrap.min.js"></script>

    <script src="js/scripts/webServices.js"></script>

    <script src="js/jquery.ui.widget.js" type="text/javascript"></script>
    <script src="js/jquery.iframe-transport.js" type="text/javascript"></script>
    <script src="js/jquery.fileupload.js" type="text/javascript"></script>
    <script src="js/jquery.cloudinary.js" type="text/javascript"></script>

    <script type="text/javascript" src="js/bootstrap-filestyle.min.js"> </script>

    <link href="css/select2.min.css" rel="stylesheet">
    <script src="js/select2.min.js"></script>

    <link rel="stylesheet" href="font-awesome-4.4.0/css/font-awesome.min.css">

    <!--pNotify related links-->
    <script type="application/javascript" src="js/pnotify.custom.min.js"></script>
    <link rel="stylesheet" href="css/pnotify.custom.min.css"/>

    <script src="js/iframeResizer.contentWindow.min.js"></script>

    <!-- jQuery Validation -->
    <script type="application/javascript" src="jqueryValidation/jquery.validate.min.js"></script>
    <script type="application/javascript" src="jqueryValidation/additional-methods.min.js"></script>

    <script>
        function closeModal(){
            window.parent.$('#btnQualModalClose').click(); // Clicking close button to dismiss modal
            window.parent.$('#btnQualModalClose1').click();

        }

        function addQual() {
//            HoldOn.open();
            var projName = $("#qual_project_name").val();
            var projSubtitle = $("#qual_project_sub").val();
            var clientName = $("#qual_client_name").val();
            var isAnonymous = $('#qual_is_anonymous').is(':checked');
            var anonymousName = $("#qual_anonymous_name").val();

            var access = $('input[name=qual_public_access]:checked').val();

            var problem = $("#qual_problems").val();
            var challenges = $("#qual_challenges").val();
            var solution = $("#qual_solution").val();
            var outcome = $("#qual_outcome").val();
            var relevance = $("#qual_relevance").val();

            var clientLogo = $('#client_logo_img').attr('src');
            var productServicesImage = $('#prod_serv_img').attr('src');

            var emailAction = $("#qual_email").val();
            var websiteAction = $("#qual_website").val();

            var industry = $("#qual_industry").val();
            var tags = $("#qual_tags").val();
            var serviceLine = $("#qual_service_line").val();

            var adminGroups = $('#ddAdminGroups').val();

            if(clientLogo == "imgs/noPreview.png"){
                clientLogo = ""; // Changing no-preview to none
            }

            if(productServicesImage == "imgs/noPreview.png"){
                productServicesImage = ""; // Changing no-preview to none
            }

            console.log(projName);
            console.log(projSubtitle);
            console.log(clientName);
            console.log(isAnonymous);
            console.log(anonymousName);
            console.log(access);
            console.log(problem);
            console.log(challenges);
            console.log(solution);
            console.log(outcome);
            console.log(relevance);
            console.log(clientLogo);
            console.log(productServicesImage);
            console.log(emailAction);
            console.log(websiteAction);
            console.log(industry);
            console.log(tags);
            console.log(serviceLine);

            console.log(adminGroups);

            insertQual(true, isAnonymous, challenges, clientName, industry,
                    tags, outcome, problem, projName, relevance, serviceLine, solution,
                    access, projSubtitle, emailAction, websiteAction,
                    clientLogo, productServicesImage, function () {
                        var qual = this;

                        if (adminGroups != null) {
                            $.each(adminGroups, function (i, val) {
                                assignQualToAdminGroup(val, qual); // Assigning qual to each selected group
                            });
                        }

                        closeModal();
                    }
            );

            // Dismissing loading screen
            setTimeout(function(){
                //location.reload();
                HoldOn.close();
            },2000);

        }

        function modifyQual() {
            var qualId = $('#qual_id').val();
            var projName = $("#qual_project_name").val();
            var projSubtitle = $("#qual_project_sub").val();
            var clientName = $("#qual_client_name").val();
            var anonymousName = $("#qual_anonymous_name").val();

            var access = $('input[name=qual_public_access]:checked').val();

            var problem = $("#qual_problems").val();
            var challenges = $("#qual_challenges").val();
            var solution = $("#qual_solution").val();
            var outcome = $("#qual_outcome").val();
            var relevance = $("#qual_relevance").val();

            var clientLogo = $('#client_logo_img').attr('src');
            var productServicesImage = $('#prod_serv_img').attr('src');

            var emailAction = $("#qual_email").val();
            var websiteAction = $("#qual_website").val();

            var industry = $("#qual_industry").val();
            var tags = $("#qual_tags").val();
            var serviceLine = $("#qual_service_line").val();

            var adminGroups = $('#ddAdminGroups').val();

            if(clientLogo == "imgs/noPreview.png"){
                clientLogo = ""; // Changing no-preview to none
            }

            if(productServicesImage == "imgs/noPreview.png"){
                productServicesImage = ""; // Changing no-preview to none
            }

            console.log(qualId);
            console.log(projName);
            console.log(projSubtitle);
            console.log(clientName);
            console.log(isAnonymous);
            console.log(anonymousName);
            console.log(access);
            console.log(problem);
            console.log(challenges);
            console.log(solution);
            console.log(outcome);
            console.log(relevance);
            console.log(clientLogo);
            console.log(productServicesImage);
            console.log(emailAction);
            console.log(websiteAction);
            console.log(industry);
            console.log(tags);
            console.log(serviceLine);

            console.log(adminGroups);

            updateQual(qualId, true, isAnonymous, challenges, clientName, industry,
                    tags, outcome, problem, projName, relevance, serviceLine, solution,
                    access, projSubtitle, emailAction, websiteAction,
                    clientLogo, productServicesImage, function () {
                        var qual = this;

                        if (adminGroups != null) {
                            $.each(adminGroups, function (i, val) {
                                assignQualToAdminGroup(val, qual.qualId); // Assigning qual to each selected group
                            });
                        }

                        closeModal();
                    }
            );
        }
    </script>
    <style>
        .fill {
            zoom: 2;

            display: block;
            margin: auto;

            height: auto;
            max-height: 100%;

            width: auto;
            max-width: 100%;
        }

        .progress-value {
            position:absolute;
            right:0;
            left:0;
        }
    </style>

    <script type="application/javascript">
        function requireAnonName() {
            document.getElementById('qual_anonymous_name').required = true;
            addRules();
        }
        function optionalAnonName() {
            document.getElementById('qual_anonymous_name').required = false;
            removeRules();
        }

        function addRules(){
            $('#qual_problems').rules('add', {"validAnon":true}); // Turns the rule on globally
            $('#qual_challenges').rules('add', {"validAnon":true});
            $('#qual_solution').rules('add', {"validAnon":true});
            $('#qual_outcome').rules('add', {"validAnon":true});
            $('#qual_relevance').rules('add', {"validAnon":true});
        }

        function removeRules(){
            $('#qual_problems').rules('remove'); // Turns the rule off globally
            $('#qual_challenges').rules('remove');
            $('#qual_solution').rules('remove');
            $('#qual_outcome').rules('remove');
            $('#qual_relevance').rules('remove');
        }

    </script>
    <script type="application/javascript">
        $(document).ready(function(){

            HoldOn.open();

            // Wrapping of default alert
            window.alert = function(message) {
                new PNotify({
                    title: 'Alert',
                    text: message,
                    type: 'error',
                    opacity: .8,
                    nonblock: {
                        nonblock: true,
                        nonblock_opacity: .2
                    },
                    buttons: {
                        show_on_nonblock: true
                    }
                });
            };

            $('#ddExistingProdServ').select2({width:"style"});
            $('#ddExistingLogo').select2({width:"style"});
            $('#ddAdminGroups').select2({width:"style", multiple:"true", placeholder:"Select Admin Groups who can view this Qual"});

            $('#ddExistingProdServ').append('<option value=\"imgs/noPreview.png\" >' + 'No Product Service Image (No image will be displayed)' + '</option>');
            $('#ddExistingLogo').append('<option value=\"imgs/noPreview.png\" >' + 'No Logo (No image will be displayed)' + '</option>');

            $('#ddExistingProdServ').val("imgs/noPreview.png").trigger("change");
            $('#ddExistingLogo').val("imgs/noPreview.png").trigger("change");

            var tags = [{id: '123', text:'test'}]; // TODO load tags with existing tags
            //e.g. tags = [{ id: 0, text: 'enhancement' }, { id: 1, text: 'bug' }, { id: 2, text: 'duplicate' }, { id: 3, text: 'invalid' }, { id: 4, text: 'wontfix' }];
            $('#qual_tags').append('<option></option>').select2({width:"style", tags:true, placeholder:"Select existing tags or enter new ones", data:tags});

            var industry = [{id:'consumerBusiness', text:'Consumer Business'}, {id:'energyAndResources', text:'Energy And Resources'},
                {id:'financialServices', text:'Financial Services'}, {id:'lifeScienceAndHealthCare', text:'Life Science And Health Care'},
                {id:'manufacturing', text:'Manufacturing'}, {id:'primary', text:'Primary'}, {id:'publicSector', text:'Public Sector'},
                {id:'realEstate', text:'Real Estate'}, {id:'technologyMediaAndTelecommunications', text:'Technology Media And Telecommunications'}];
            $('#qual_industry').append('<option></option>').select2({width:"style", placeholder:"Select Industry", data:industry});

            var serviceline = [{id:'audit', text:'Audit'}, {id:'deloittePrivate', text:'Deloitte Private'},
                {id:'financialAdvisory', text:'Financial Advisory'}, {id:'humanCapital', text:'Human Capital'},
                {id:'operations', text:'Operations'},{id:'risk', text:'Risk'},{id:'strategy', text:'Strategy'},
                {id:'tax', text:'Tax'},{id:'technology', text:'Technology'}];
            $('#qual_service_line').append('<option></option>').select2({width:"style", placeholder:"Select service line", data:serviceline});

            getAllProjectImages(function () {
                var prodServs = this;
                $.each(prodServs, function(i, val){
                    $('#ddExistingProdServ').append('<option value="'+val.imageUrl+'" >' + val.publicId + '</option>');
                });
            });

            getAllClientImages(function (){
                var logos = this;
                $.each(logos, function(i, val){
                    $('#ddExistingLogo').append('<option value="'+val.imageUrl+'" >' + val.publicId + '</option>');
                });
            });

            getAllAdminGroups(function (){
                var groups = this;
                $.each(groups, function(i, val){
                    // There should always be atleast one admin group available
                    if(val.isActive == true) {
                        $('#ddAdminGroups').append('<option value="' + val.id + '">' + val.name + '</option>');
                    }
                });
            });

            var qual_id = sessionStorage.getItem("dup_qual_id");
            if (qual_id != null) {
                $('#btnReset').prop('disabled', true); // Disabling reset for now as would clear entire form instead of resetting to original values
                getQualById(qual_id, function() {
                    var qual = this; // gets the qual info
                    $("#qual_project_name").val(qual.projectName);
                    $("#qual_project_sub").val(qual.subtitle);
                    $("#qual_client_name").val(qual.clientName);
                    $("#qual_anonymous_name").val(qual.qual_anonymous);
                    $("#qual_email").val(qual.emailButton);
                    $("#qual_website").val(qual.websiteButton);
                    $("#qual_industry").val(qual.industry).trigger('change');
                    $("#qual_problems").val(qual.problemStatement);
                    $("#qual_solutions").val(qual.solutionStatement);
                    $("#qual_challenges").val(qual.challengesFaced);
                    $("#qual_outcome").val(qual.outcomeStatement);
                    $("#qual_relevance").val(qual.relevanceToClient);
                    $("#qual_service_line").val(qual.serviceLine).trigger('change');
                    $('#qual_tags').val(qual.tags).trigger('change');

                    if(qual.isAnonymous == true){
                        $('#qual_is_not_anonymous').attr('checked', false);
                        $('#qual_is_anonymous').attr('checked', true).trigger('click');
                    }

                    if(qual.status == "open"){
                        $('#qual_private').attr('checked', false);
                        $('#qual_public').attr('checked', true).trigger('click');
                    }

                    var clientLogo = qual.clientImage;

                    var productServicesImage = qual.projectImage;

                    if(clientLogo == ""){
                        clientLogo = "imgs/noPreview.png"; // Changing none to no-preview
                    }

                    if(productServicesImage == ""){
                        productServicesImage = "imgs/noPreview.png"; // Changing no-preview to none
                    }

                    $('#ddExistingProdServ').val(productServicesImage).trigger("change");
                    $('#ddExistingLogo').val(clientLogo).trigger("change");
                });

                var groups = [];
                getAdminGroupsByQual(qual_id, function(){
                    var ag = this;
                    $.each(ag, function(i, val) {
                        groups.push(val.id);
                    });
                });
                $('#ddAdminGroups').val(groups).trigger("change");

                sessionStorage.removeItem("dup_qual_id");
            }else{ // dup_qual_id is null
                qual_id = sessionStorage.getItem("edit_qual_id");
                if(qual_id != null) {
                    $('#btnReset').prop('disabled', true); // Disabling reset for now as would clear entire form instead of resetting to original values

                    $('#page_title').text("Edit Qual");
                    $('#qual_add_form').attr('action', 'javascript:modifyQual();');
                    $('#qual_id').val(qual_id);

                    getQualById(qual_id, function() {
                        var qual = this; // gets the qual info
                        $("#qual_project_name").val(qual.projectName);
                        $("#qual_project_sub").val(qual.subtitle);
                        $("#qual_client_name").val(qual.clientName);
                        $("#qual_anonymous_name").val(qual.qual_anonymous);
                        $("#qual_email").val(qual.emailButton);
                        $("#qual_website").val(qual.websiteButton);
                        $("#qual_industry").val(qual.industry).trigger('change');
                        $("#qual_problems").val(qual.problemStatement);
                        $("#qual_solutions").val(qual.solutionStatement);
                        $("#qual_challenges").val(qual.challengesFaced);
                        $("#qual_outcome").val(qual.outcomeStatement);
                        $("#qual_relevance").val(qual.relevanceToClient);
                        $("#qual_service_line").val(qual.serviceLine).trigger('change');
                        $('#qual_tags').val(qual.tags).trigger('change');

                        if(qual.isAnonymous == true){
                            $('#qual_is_not_anonymous').attr('checked', false);
                            $('#qual_is_anonymous').attr('checked', true).trigger('click');
                        }

                        if(qual.status == "open"){
                            $('#qual_private').attr('checked', false);
                            $('#qual_public').attr('checked', true).trigger('click');
                        }

                        var clientLogo = qual.clientImage;

                        var productServicesImage = qual.projectImage;

                        if(clientLogo == ""){
                            clientLogo = "imgs/noPreview.png"; // Changing none to no-preview
                        }

                        if(productServicesImage == ""){
                            productServicesImage = "imgs/noPreview.png"; // Changing no-preview to none
                        }

                        $('#ddExistingProdServ').val(productServicesImage).trigger("change");
                        $('#ddExistingLogo').val(clientLogo).trigger("change");
                    });

                    var groups = [];
                    getAdminGroupsByQual(qual_id, function(){
                        var ag = this;
                        $.each(ag, function(i, val) {
                            groups.push(val.id);
                        });
                    });
                    $('#ddAdminGroups').val(groups).trigger("change");
                }
                sessionStorage.removeItem("edit_qual_id");
            }

            HoldOn.close();

        });

        function SelectProdServ(url) {
            $('#prod_serv_img').attr('src', url);
        }
        function SelectLogo(url) {
            $('#client_logo_img').attr('src', url);
        }

        function ManualReset(){
            HoldOn.open();
            $("#qual_industry").select2("val", "");
            $("#ddAdminGroups").select2("val", "");
            $("#qual_tags").select2("val", "");
            $("#qual_service_line").select2("val", "");

            $('#ddExistingProdServ').val("imgs/noPreview.png").trigger("change");
            $('#ddExistingLogo').val("imgs/noPreview.png").trigger("change");

            $('.prod_serv_progress').hide();

            $('.client_logo_progress').hide();

            setTimeout(function(){
                location.reload();
                HoldOn.close();
            },2000);

        }

        function checkURL (abc) {
            var string = abc.value;
            console.log(string);
            console.log(string.length);

            if(string.length <= 0){
                return string; // Do nothing if string is empty
            }

            if (!~string.indexOf("http")){
                string = "http://" + string;
            }
            abc.value = string;
            return abc
        }
    </script>
</head>

<body id="body">
<div class="alert alert-info alert-dismissible" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <strong>Heads Up!</strong> Please use CTRL Shift V / ⌘CMD Shift V to paste formatted content from PowerPoint, Word, etc
</div>

<form id="qual_add_form" action="javascript:addQual();" class="container-fluid" >
    <input type="hidden" id="qual_id">
    <div class="row">
        <div class="col-md-6">
            <div class="row">
                <div class="col-md-12">
                    <div class="row ">
                        <div class="col-md-12">
                            <div class="img-responsive">
                                <img id="prod_serv_img" class="img-rounded fill" src="imgs/noPreview.png"/>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <br/>
                            <select id="ddExistingProdServ" style="width: 100%;" onchange="SelectProdServ(this.value)"  class="form-control" >
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="prod_serv_image-upload">
                                <label for="qual_product_service_img"> <!-- element with this id only exists after document loads -->
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <br/>
                        <div class="col-md-12">
                            <div class="progress prod_serv_progress">
                                <div class="progress-bar progress-bar-success progress-bar-striped prod_serv_progress-bar" role="progressbar"
                                     aria-valuemin="0" aria-valuemax="100" >
                                    <span id="prod_serv_progress-value" class="progress-value" style="color: #000;"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6" style="background-color: #dcdcdc;padding-bottom: 20px;padding-top: 20px;">
            <div class="row">
                <div class="col-md-6" >
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label id="project_name" for="qual_project_name">Project Name: *</label>
                                <input id="qual_project_name" name="project" type="text" class="form-control" placeholder="Project Name"
                                       required autofocus>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="qual_project_sub">Project Subtitle: </label>
                                <input id="qual_project_sub" type="text" class="form-control" placeholder="Subtitle">
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label id="client_name" for="qual_client_name">Client Name: *</label>
                                <input id="qual_client_name" name="client" type="text" class="form-control" placeholder="Client Name"
                                       required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="img-responsive">
                                        <img id="client_logo_img" class="img-rounded fill" src="imgs/noPreview.png"/>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <br/>
                                    <!-- Width 100% fixes issue caused by iframe resizing affecting select2 -->
                                    <select id="ddExistingLogo" style="width: 100%;" onchange="SelectLogo(this.value)"  class="form-control" >
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="client_logo_image-upload">
                                        <label for="qual_client_logo"> <!-- element with this id only exists after document loads --></label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <br/>
                                <div class="col-md-12">
                                    <div class="progress client_logo_progress">
                                        <div class="progress-bar progress-bar-success progress-bar-striped client_logo_progress-bar" role="progressbar"
                                             aria-valuemin="0" aria-valuemax="100" >
                                            <span id="client_logo_progress-value" class="progress-value" style="color: #000;"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="qual_anonymous_name">Anonymous Name: </label>
                        <input id="qual_anonymous_name" type="text" class="form-control" placeholder="Anonymous Name">
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="qual_is_not_anonymous">Qual Anonymity: </label>

                    <div class="btn-group btn-group-justified" data-toggle="buttons">
                        <label class="btn btn-default active" onclick="optionalAnonName();">
                            <input type="radio" id="qual_is_not_anonymous" name="qual_anonymous"
                                   checked="checked"/><i class="fa fa-user"></i> Named
                        </label>
                        <label id="anonName" class="btn btn-default" onclick="requireAnonName();">
                            <input type="radio" id="qual_is_anonymous" name="qual_anonymous"/>
                            <i class="fa fa-user-secret"></i> Anonymous
                        </label>
                    </div>
                    <br/>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="qual_email">Email Action: </label>
                        <input id="qual_email" type="email" class="form-control" placeholder="Email">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="qual_website">Website Action: </label>
                        <input id="qual_website" type="url" class="form-control" placeholder="Website" onblur="checkURL(this)">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="qual_industry">Industry: </label>
                        <select id="qual_industry" name="industry" style="width:100%;" class="form-control">
                        </select>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="ddAdminGroups">Viewable By:</label>
                        <select id="ddAdminGroups" name="admins" style="width: 100%;" class="form-control" required>
                        </select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <label for="qual_private">Qual Accessibility: </label>
                    <br/>

                    <div class="btn-group-justified" data-toggle="buttons">
                        <label class="btn btn-default active">
                            <input type="radio" id="qual_private" name="qual_public_access" value="confidential"
                                   checked="checked"/><i class="fa fa-lock"></i> Private
                        </label>
                        <label class="btn btn-default">
                            <input type="radio" id="qual_public" name="qual_public_access" value="open"/>
                            <i class="fa fa-unlock"></i> Public
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br/>

    <div class="row">
        <div class="col-md-12">
            <div class="form-group">
                <label id="prob_stat" for="qual_problems">Problem Statement: *</label>
                <textarea id="qual_problems" name="problems" rows="3" class="form-control" placeholder="Problem Statement"
                          required></textarea>
            </div>
            <div class="form-group">
                <label for="qual_challenges">Challenges Faced: </label>
                <textarea id="qual_challenges" rows="3" class="form-control" placeholder="Challenges"></textarea>
            </div>
            <div class="form-group">
                <label for="qual_solution">Solution: </label>
                <textarea id="qual_solution" rows="3" class="form-control" placeholder="Solution"></textarea>
            </div>
            <div class="form-group">
                <label for="qual_outcome">Outcome: </label>
                <textarea id="qual_outcome" rows="3" class="form-control" placeholder="Outcome"></textarea>
            </div>
            <div class="form-group">
                <label for="qual_relevance">Relevance to Client: </label>
                <textarea id="qual_relevance" rows="3" class="form-control"
                          placeholder="Relevance to Client"></textarea>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="qual_tags">Tags: </label>
                <select id="qual_tags" name="tags" style="width:100%;" class="form-control">
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="qual_service_line">Service Line: </label>
                <select id="qual_service_line" name="service" style="width:100%;" class="form-control">
                </select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <button id="btn_submit" type="submit" class="btn btn-block btn-success" ><span
                        class="glyphicon glyphicon-floppy-disk"></span> Submit
                </button>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <button type="reset" id="btnReset" class="btn btn-block btn-danger" onclick="ManualReset();">
                    <span class="glyphicon glyphicon-repeat"></span> Reset
                </button>
            </div>
        </div>
    </div>
</form>

<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="js/ie10-viewport-bug-workaround.js"></script>
<script type="text/javascript">
    // Setting configs
    $.cloudinary.config({cloud_name: 'onlineportfolio', api_key: '699754899746833'});

    // Hiding progress bars
    $('.prod_serv_progress').hide();
    $('.client_logo_progress').hide();

    // Adding input to correct location
    $('.prod_serv_image-upload').append($.cloudinary.unsigned_upload_tag(
                    "ug21hs7g",
                    {cloud_name: 'onlineportfolio', tags: 'PRODSERV'},
                    {multiple: false},
                    // With specified id
                    "qual_product_service_img")
            // Binding events
    ).bind('cloudinarystart', function (e, data) {
                $('.prod_serv_progress').show();
                $('.prod_serv_progress-bar').addClass('active');
            }
    ).bind('cloudinarydone', function (e, data) {
                console.log(data);
                insertImage(true, data.result.public_id, 'PRODSERV', data.result.url, function(){});

                $('#ddExistingProdServ').append('<option value="' + data.result.url + '" >' + data.result.public_id + '</option>'); // Adding to select list, so can change back to if necessary
                $('#ddExistingProdServ').val(data.result.url).trigger("change"); // Triggering change event to cause new addition to be the selected option

                $('.prod_serv_progress-bar').removeClass('active');
                $('#prod_serv_progress-value').text("Upload Complete");
                $('#prod_serv_img').attr('src', data.result.url);
            }
    ).bind('cloudinaryprogress', function (e, data) {
                $('.prod_serv_progress-bar').css('width', Math.round((data.loaded * 100.0) / data.total) + '%');
                $('#prod_serv_progress-value').text(Math.round((data.loaded * 100.0) / data.total) + '%');
            }
    ).bind('cloudinaryfail', function (e, data) {
                $('#prod_serv_progress-value').text("Upload Failed");
                console.log(e);
                console.log(data);
            }
    );
    $('.client_logo_image-upload').append($.cloudinary.unsigned_upload_tag(
                    "ug21hs7g",
                    {cloud_name: 'onlineportfolio', tags: 'LOGO'},
                    {multiple: false},
                    // With specified id
                    "qual_client_logo")
            // Binding events
    ).bind('cloudinarystart', function (e, data) {
                $('.client_logo_progress').show();
                $('.client_logo_progress-bar').addClass('active');
            }
    ).bind('cloudinarydone', function (e, data) {

                insertImage(true, data.result.public_id, 'LOGO', data.result.url, function(){});

                $('#ddExistingLogo').append('<option value="' + data.result.url + '" >' + data.result.public_id + '</option>'); // Adding to select list, so can change back to if necessary
                $('#ddExistingLogo').val(data.result.url).trigger("change"); // Triggering change event to cause new addition to be the selected option

                $('.client_logo_progress-bar').removeClass('active');
                $('#client_logo_progress-value').text("Upload Complete");
                $('#client_logo_img').attr('src', data.result.url);
            }
    ).bind('cloudinaryprogress', function (e, data) {
                $('.client_logo_progress-bar').css('width', Math.round((data.loaded * 100.0) / data.total) + '%');
                $('#client_logo_progress-value').text(Math.round((data.loaded * 100.0) / data.total) + '%');
            }
    ).bind('cloudinaryfail', function (e, data) {
                $('#client_logo_progress-value').text("Upload Failed");
                console.log(e);
                console.log(data);
            }
    );

    // Styling for the image upload buttons
    $('#qual_product_service_img').filestyle({
        buttonText: "Upload Product Service Image",
        iconName: "glyphicon glyphicon-cloud-upload",
        input: false,
        badge: false
    });
    $('#qual_client_logo').filestyle({
        buttonText: "Upload Client Logo Image",
        iconName: "glyphicon glyphicon-cloud-upload",
        input: false,
        badge: false
    });


    $.validator.addMethod("validAnon", function(value, element){
        //console.log(element);

        var client = $('#qual_client_name').val();

        if(element.id == "qual_client_name"){
            console.log("Ignoring");
            return true;
        }

        console.log(value);
        console.log(client);

        if(! client || client.length <= 0){
            return true; // No point validating if no client name yet entered
        }
        else if(! value || value.length <= 0){
            return true; // No point validating if specific element has no text
        }
        else{
            console.log(value);
            console.log(client);

            // If element contains the specified value then return false
            if(value.toLowerCase().indexOf(client.toLowerCase()) >= 0)
            {
                console.log("Failed");
                return false;
            }
            else
            {
                console.log("Passed");
                return true;
            }
        }
    }, "Anonymous Qual's cannot contain the Client Name");

    // jQueryValidation
    $('#qual_add_form').validate({
        rules:{
            project:{
                required: true
            },
            client:{
                required: true
            },
            industry:{
                required: true
            },
            admins:{
                required: true
            },
            problems:{
                required: true
            },
            tags:{
                required: true
            },
            service:{
                required: true
            }
        },
        highlight: function(element) {
            $(element).closest('.form-group').addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },
        errorElement: 'span',
        errorClass: 'help-block',
        errorPlacement: function(error, element) {
            if(element.parent('.input-group').length) {
                error.insertAfter(element.parent());
            } else {
                error.insertAfter(element);
            }
        }
    });

</script>
</body>
</html>